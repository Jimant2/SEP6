@page "/login"
@inject HttpClient httpClient
@inject NavigationManager navigationManager
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavgMan
@inject IUserService IuserService;
@using System.Net.Http;
@using SEP6.Authentication;
@using SEP6.Data;
@using SEP6.Models;

<h2>Movies4U</h2>
<div class="container">
    <div class="image-container">
        <img src="/img/favpng_movie-logo.png" class="login-page-logo" />
    </div>

    <div class="form-group px-4">
        <label for="name">Name:</label>
        <input autofocus="true" id="name" class="form-control" @bind="@name" />
    </div>

    <div class="form-group px-4">
        <label for="id">Password:</label>
        <input type="password" id="myInput" class="form-control" @bind="@password" />
    </div>

    <div class="bottom-row px-4">
        <div class="spacer"></div> <!-- Spacer to push the login button below -->
        <AuthorizeView>
            <NotAuthorized>
                <div>
                    <button class="btn btn-primary custom-btn" @onclick="Login">Login</button>
                </div>
                <div>
                    <button class="btn btn-primary custom-btn" @onclick="GoBack">Go Back</button>
                </div>
            </NotAuthorized>
        </AuthorizeView>
    </div>
</div>
@*<div class="container">
    <div class="image-container">
        <img src="/img/favpng_movie-logo.png" class="login-page-logo" />
    </div>

    <div class="form-group px-4">
        <label for="name">Name:</label>
        <input autofocus="true" id="name" class="form-control" @bind="@name" />
    </div>

    <div class="form-group px-4">
        <label for="id">Password:</label>
        <input type="password" id="myInput" class="form-control" @bind="@password" />
    </div>

    <div class="bottom-row px-4">
        <div class="spacer"></div> <!-- Spacer to push the login button below -->
        <AuthorizeView>
            <NotAuthorized>
                <div>
                <button class="btn btn-primary custom-btn" @onclick="Login">Login</button>
                </div>
                <div>
                <button class="btn btn-primary custom-btn" @onclick="GoBack">Go Back</button>
                </div>
            </NotAuthorized>
        </AuthorizeView>

    </div>
</div>*@
<p>@errorMessage</p>

@code {
    private string? name;
    private string? password;
    private string errorMessage;
   

    private async Task Login()
    {
        try
        {
            await ((CustomAuthenticationStateProvider)AuthenticationStateProvider).ValidateLogin(name, password);
            Console.WriteLine("Entering Login method");
            
            NavgMan.NavigateTo("/index");
        }
        catch (Exception e)
        {
            Console.WriteLine(e.Message);
            errorMessage = e.Message;
        }
    }
    private void GoBack()
    {
        navigationManager.NavigateTo(navigationManager.Uri, forceLoad: true);
    }
  

}